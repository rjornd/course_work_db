{"ast":null,"code":"import axios from 'axios';\nimport { hideLoader, showLoader } from '../reducers/appReducer';\nimport { addFile, deleteFileAction, setFiles } from '../reducers/fileReducer';\nimport { addUploadFile, changeUploadFile, showUploader } from '../reducers/uploadReducer';\nexport function getFiles(dirId, sort) {\n  return async dispatch => {\n    try {\n      dispatch(showLoader());\n      let url = 'http://localhost:5000/api/files';\n\n      if (dirId) {\n        url = `http://localhost:5000/api/files?parent=${dirId}`;\n      }\n\n      if (sort) {\n        url = `http://localhost:5000/api/files?sort=${sort}`;\n      }\n\n      if (sort && dirId) {\n        url = `http://localhost:5000/api/files?parent=${dirId}&sort=${sort}`;\n      }\n\n      const response = await axios.get(url, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem('token')}`\n        }\n      });\n      dispatch(setFiles(response.data));\n      console.log(response.data);\n      alert('здесь');\n    } catch (e) {\n      alert('тут');\n      alert(e.response.data.message);\n    } finally {\n      dispatch(hideLoader());\n    }\n  };\n}\nexport function createDir(dirId, name) {\n  return async dispatch => {\n    try {\n      const response = await axios.post(`http://localhost:5000/api/files/`, {\n        name,\n        parent: dirId,\n        type: 'dir'\n      }, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem('token')}`\n        }\n      });\n      dispatch(addFile(response.data));\n    } catch (e) {\n      alert(e.response.data.message);\n    }\n  };\n}\nexport function deleteFile(file) {\n  return async dispatch => {\n    try {\n      const response = await axios.delete(`http://localhost:5000/api/files?id=${file._id}`, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem('token')}`\n        }\n      });\n      dispatch(deleteFileAction(file._id));\n      alert(response.data.message);\n    } catch (e) {\n      var _e$response, _e$response$data;\n\n      alert(e === null || e === void 0 ? void 0 : (_e$response = e.response) === null || _e$response === void 0 ? void 0 : (_e$response$data = _e$response.data) === null || _e$response$data === void 0 ? void 0 : _e$response$data.message);\n    }\n  };\n}\nexport function uploadFile(file, dirId) {\n  return async dispatch => {\n    try {\n      const formData = new FormData();\n      formData.append('file', file);\n\n      if (dirId) {\n        formData.append('parent', dirId);\n      }\n\n      let uploadfile = {\n        name: file.name,\n        progress: 0,\n        id: Date.now()\n      };\n      dispatch(showUploader());\n      dispatch(addUploadFile(uploadfile));\n      const response = await axios.post(`http://localhost:5000/api/files/upload`, formData, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem('token')}`\n        },\n        onUploadProgress: progressEvent => {\n          const totalLength = progressEvent.lengthComputable ? progressEvent.total : progressEvent.target.getResponseHeader('content-length') || progressEvent.target.getResponseHeader('x-decompressed-content-length');\n          console.log('total', totalLength);\n\n          if (totalLength) {\n            uploadfile.progress = Math.round(progressEvent.loaded * 100 / totalLength);\n            dispatch(changeUploadFile(uploadfile));\n          }\n        }\n      });\n      dispatch(addFile(response.data));\n    } catch (e) {\n      alert(e.response.data.message);\n    }\n  };\n}\nexport async function downloadFile(file) {\n  const response = await fetch(`http://localhost:5000/api/files/download?id=${file._id}`, {\n    headers: {\n      Authorization: `Bearer ${localStorage.getItem('token')}`\n    }\n  });\n\n  if (response.status === 200) {\n    const blob = await response.blob();\n    const downloadUrl = window.URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = downloadUrl;\n    link.download = file.name;\n    document.body.appendChild(link);\n    link.click();\n    link.remove();\n  }\n}","map":{"version":3,"sources":["C:/GitHub/ProtectedMessenger/client/src/actions/file.js"],"names":["axios","hideLoader","showLoader","addFile","deleteFileAction","setFiles","addUploadFile","changeUploadFile","showUploader","getFiles","dirId","sort","dispatch","url","response","get","headers","Authorization","localStorage","getItem","data","console","log","alert","e","message","createDir","name","post","parent","type","deleteFile","file","delete","_id","uploadFile","formData","FormData","append","uploadfile","progress","id","Date","now","onUploadProgress","progressEvent","totalLength","lengthComputable","total","target","getResponseHeader","Math","round","loaded","downloadFile","fetch","status","blob","downloadUrl","window","URL","createObjectURL","link","document","createElement","href","download","body","appendChild","click","remove"],"mappings":"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","sourcesContent":["import axios from 'axios'\r\nimport { hideLoader, showLoader } from '../reducers/appReducer'\r\nimport { addFile, deleteFileAction, setFiles } from '../reducers/fileReducer'\r\nimport { addUploadFile, changeUploadFile, showUploader } from '../reducers/uploadReducer'\r\n\r\nexport function getFiles(dirId, sort){\r\n    return async dispatch => {\r\n        try {\r\n            dispatch(showLoader())\r\n            let url = 'http://localhost:5000/api/files'\r\n            if (dirId) \r\n            {\r\n                url = `http://localhost:5000/api/files?parent=${dirId}`\r\n            }\r\n            if (sort) \r\n            {\r\n                url =  `http://localhost:5000/api/files?sort=${sort}`\r\n            }\r\n            if(sort && dirId)\r\n            {\r\n                url = `http://localhost:5000/api/files?parent=${dirId}&sort=${sort}`\r\n            }\r\n            const response = await axios.get(url, {\r\n                headers: {Authorization: `Bearer ${localStorage.getItem('token')}`}\r\n            })\r\n            dispatch(setFiles(response.data))\r\n            console.log(response.data)\r\n            alert('здесь')\r\n         } \r\n        catch (e) {\r\n            alert('тут')\r\n            alert(e.response.data.message)\r\n        } \r\n        finally {            \r\n            dispatch(hideLoader())\r\n        }      \r\n    }\r\n}\r\n\r\nexport function createDir(dirId, name){\r\n    return async dispatch => {\r\n        try {\r\n            const response = await axios.post(`http://localhost:5000/api/files/`, {\r\n                name,\r\n                parent: dirId,\r\n                type: 'dir'\r\n            },\r\n            {\r\n                headers: {Authorization: `Bearer ${localStorage.getItem('token')}`}\r\n            })\r\n            dispatch(addFile(response.data))\r\n        } catch (e) {\r\n            alert(e.response.data.message)\r\n        }\r\n    }\r\n}\r\n\r\nexport function deleteFile(file){\r\n    return async dispatch => {\r\n        try {\r\n            const response = await axios.delete(`http://localhost:5000/api/files?id=${file._id}`, {\r\n\r\n                headers: {Authorization: `Bearer ${localStorage.getItem('token')}`}\r\n            })\r\n            dispatch(deleteFileAction(file._id))\r\n            alert(response.data.message)\r\n        } catch (e) {\r\n            alert(e?.response?.data?.message)\r\n        }\r\n    }\r\n}\r\n\r\n\r\nexport function uploadFile(file, dirId){\r\n    return async dispatch => {\r\n        try {\r\n            const formData = new FormData()\r\n            formData.append('file', file)\r\n            if(dirId){\r\n                formData.append('parent', dirId)\r\n            }\r\n            let uploadfile = {name: file.name, progress: 0, id: Date.now()}\r\n            dispatch(showUploader())\r\n            dispatch(addUploadFile(uploadfile))\r\n            const response = await axios.post(`http://localhost:5000/api/files/upload`, formData, \r\n            {\r\n                headers: {Authorization: `Bearer ${localStorage.getItem('token')}`},\r\n                onUploadProgress: progressEvent => {\r\n                    const totalLength = progressEvent.lengthComputable ? progressEvent.total : progressEvent.target.getResponseHeader('content-length') || progressEvent.target.getResponseHeader('x-decompressed-content-length');\r\n                    console.log('total', totalLength)\r\n                    if (totalLength) {\r\n                        uploadfile.progress = Math.round((progressEvent.loaded * 100) / totalLength)\r\n                        dispatch(changeUploadFile(uploadfile))\r\n                    }\r\n                }\r\n            })\r\n            dispatch(addFile(response.data))\r\n        } catch (e) {\r\n            alert(e.response.data.message)\r\n        }\r\n    }\r\n}\r\n\r\nexport async function downloadFile(file){\r\n   const response = await fetch(`http://localhost:5000/api/files/download?id=${file._id}`, {\r\n       headers: {Authorization: `Bearer ${localStorage.getItem('token')}`}\r\n    })\r\n    if (response.status === 200) {\r\n        const blob = await response.blob()\r\n        const downloadUrl = window.URL.createObjectURL(blob)\r\n        const link = document.createElement('a')\r\n        link.href = downloadUrl\r\n        link.download = file.name\r\n        document.body.appendChild(link)\r\n        link.click()\r\n        link.remove()\r\n    }\r\n}\r\n\r\n"]},"metadata":{},"sourceType":"module"}